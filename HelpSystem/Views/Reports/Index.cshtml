@using HelpSystem.Domain.ViewModel.Report
@model dynamic

@{
    ViewBag.Title = "Отчёты";
    Layout = "_Layout";
}


<link rel="stylesheet" href="~/JQUERY/jquery.datetimepicker.min.css"/>
<style>
   
    .nav-pills {
        display: none;
        border: 2px solid #ced4da; /* Добавляем рамку */
        box-shadow: 0 2px 4px rgba(0, 15, 11, 0.1); 
        border-radius: 10px; /* Добавляем скругление углов */
    }
     .report-container
    {
        position: relative;
        height: 500px; 
        overflow-y: auto; /* Включаем вертикальный скроллинг */
        overflow-x: auto;
        border: 2px solid #ccc; /* Добавляем рамку для контейнера */
        padding: 10px; /* Добавляем внутренний отступ */
        margin:20px;
        box-shadow: 0 2px 4px rgba(0, 15, 11, 0.2);
   
    }

    .scrollable-content {
        max-height: 100%;
    }

    #CloseReportsBtn {
        position: absolute;
        top: 10px;
        right: 6px;
    }
    
  /*Стили для самой таблицы*/
    .table-bordered {
        width: 100%;
        margin-bottom: 1rem;
        color: #212529;
        border-collapse: collapse;
        border: 2px solid #dee2e6;
        box-shadow: 0 2px 4px rgb(7,7,24)
    }

        .table-bordered th, .table-bordered td {
            padding: 0.75rem;
            vertical-align: top;
            border: 2px solid #dee2e6;
        }

        .table-bordered thead th {
            vertical-align: bottom;
            border-bottom: 2px solid #dee2e6;
            background-color: #f8f9fa;
        }

        /* Эффект при наведении на строки таблицы */
        .table-bordered tbody tr:hover {
            background-color: #ffff99;
            cursor: pointer;
        }

  
      
  



</style>
<ul class="nav nav-pills">
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownReports" role="button" data-bs-toggle="dropdown" aria-expanded="false">Отчёты</a>
        <ul class="dropdown-menu" aria-labelledby="navbarDropdownReports">
            <li><a class="dropdown-item" id="UserReportId" href="#">Отчёт по пользователю</a></li>
            <li><a class="dropdown-item" href="#" id="reportUsersProductsBtn">Отчёт по пользователям</a></li>
            <li><a class="dropdown-item" href="#" id="openDatePicker">Отчёт по поступлениям</a></li>
            <li><a class="dropdown-item" href="#" id="reportDebitingProduct">Отчёт по списанным товарам</a></li>
        </ul>
    </li>
</ul>
<div style="display:none" class="report-container" id="reportContainer">
  
    
    
</div>



@section Scripts
{
    <script src="~/JQUERY/jquery.datetimepicker.full.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

    <script>
        $.datetimepicker.setLocale('ru');
        $(document).ready(function() {

      //Обработка события нажатия кнопки отчёта по пользователям
            $('#reportUsersProductsBtn').on("click",function() {

                UsersReports();
            });
            // Добавляем анимацию с помощью jQuery
            $('.nav-pills').slideDown(500);

            //Функция для открытия окна и поиска юзверя
        $(document).on("click", "#UserReportId", function () {

            initialiseUserReport();
            $('#userModal').modal('show');
        });

            $('#reportDebitingProduct').on("click", function () {
                ReportDebbetingProdict();
            });
        // Функция для открытия диалогового окна и выбора даты с помощью flatpickr
        $(document).on("click", "#openDatePicker", function () {
            const startDateInput = $('<input>').attr({
                type: 'text',
                id: 'startDate',
                class: 'form-control mb-2',
                placeholder: 'Начальная дата'
            });
            const endDateInput = $('<input>').attr({
                type: 'text',
                id: 'endDate',
                class: 'form-control',
                placeholder: 'Конечная дата'
            });

            Swal.fire({
                title: 'Выберите даты',
                html: startDateInput[0].outerHTML + endDateInput[0].outerHTML,
                focusConfirm: false,
                didOpen: () => {
                    $('#startDate').datetimepicker({
                        format: 'd.m.Y', // Формат даты (день.месяц.год)
                        timepicker: false // Отключение времени
                    });

                    $('#endDate').datetimepicker({
                        format: 'd.m.Y', // Формат даты (день.месяц.год)
                        timepicker: false // Отключение времени
                    });
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const startDateStr = $('#startDate').val();
                    const endDateStr = $('#endDate').val();

                    const startDate = new Date(startDateStr.split('.').reverse().join('-'));
                    const endDate = new Date(endDateStr.split('.').reverse().join('-'));

                    // Проверяем, если конечная дата меньше начальной, выдаем ошибку
                    if (startDate > endDate) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Ошибка',
                            text: 'Конечная дата не может быть меньше начальной.'
                        });
                    } else {
                        // Всё в порядке, передаем даты в функцию ReportsWarehouse
                            ReportsWarehouse(startDateStr, endDateStr);
                    }
                }
            });
        });
        });
    </script>
}
